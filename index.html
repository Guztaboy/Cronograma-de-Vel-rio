<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />
    <title>Informativo de Velórios</title>
    <link rel="shortcut icon" href="passaro.svg" type="image/x-icon" />
  </head>
  <body>
    <!-- cont full -->
    <div id="content">
      <h1>Informativo de Velórios</h1>

      <!-- table -->
      <table id="editableTable">
        <thead>
          <tr>
            <th>Cemitério</th>
            <th>Nome do Falecido</th>
            <th>Data do Velório</th>
            <th>Horário de início</th>
            <th>Horário do Fim do Velório</th>
            <th>Sala do Velório</th>
            <th>Data & Horário de Sepultamento</th>
            <th>Destino</th>
          </tr>
        </thead>
        <tbody>
          <!-- As linhas serão preenchidas via JavaScript -->
        </tbody>
      </table>

      <!-- imgs -->
      <div class="logo-background">
        <img src="logocortel.svg" alt="Logo" />
      </div>
      <div class="logo-background2">
        <img src="passaro.svg" alt="Logo" />
      </div>
      <div class="logo-background3">
        <img src="prefeitura.svg" alt="" />
      </div>
    </div>

    <!-- vídeo -->
    <div id="video-container">
      <video id="video" loop muted autoplay>
        <source src="video1.mp4" type="video/mp4" />
        Seu navegador não suporta a execução do vídeo.
      </video>
    </div>

    <script>
      // Função para salvar os dados da tabela no LocalStorage
      function salvarDados() {
        const table = document.getElementById("editableTable");
        const rows = table.querySelectorAll("tbody tr");
        const dados = [];

        rows.forEach((row) => {
          const cells = row.querySelectorAll("td");
          const rowData = {
            cemiterio: cells[0].textContent,
            nome: cells[1].textContent,
            dataVelorio: cells[2].textContent,
            inicioVelorio: cells[3].textContent,
            fimVelorio: cells[4].textContent,
            sala: cells[5].textContent,
            sepultamento: cells[6].textContent,
            destino: cells[7].textContent,
          };
          dados.push(rowData);
        });

        localStorage.setItem("tabelaDados", JSON.stringify(dados));
      }

      // Função para carregar os dados da tabela do LocalStorage
      function carregarDados() {
        const dadosSalvos = localStorage.getItem("tabelaDados");
        if (dadosSalvos) {
          const dados = JSON.parse(dadosSalvos);
          const tbody = document.querySelector("#editableTable tbody");
          tbody.innerHTML = "";

          dados.forEach((rowData) => {
            const row = document.createElement("tr");
            row.innerHTML = `
              <td>${rowData.cemiterio}</td>
              <td>${rowData.nome}</td>
              <td>${rowData.dataVelorio}</td>
              <td>${rowData.inicioVelorio}</td>
              <td>${rowData.fimVelorio}</td>
              <td>${rowData.sala}</td>
              <td>${rowData.sepultamento}</td>
              <td>${rowData.destino}</td>
            `;
            tbody.appendChild(row);
          });
        }
      }

      // Carrega os dados ao abrir a página
      carregarDados();

      // Edit da tabela
      const table = document.getElementById("editableTable");
      table.addEventListener("click", function (event) {
        const target = event.target;
        if (target.tagName === "TD") {
          target.setAttribute("contenteditable", true);
          target.focus();
        }
      });

      // Salva os dados ao sair da edição
      table.addEventListener(
        "blur",
        function (event) {
          const target = event.target;
          if (target.tagName === "TD") {
            target.removeAttribute("contenteditable");
            salvarDados(); // Salva os dados no LocalStorage
          }
        },
        true
      );

      // Alternar entre tabela e vídeo
      const tempoExibicao = 60000;
      let isEditing = false;

      function alternar() {
        if (isEditing) return;

        const content = document.getElementById("content");
        const videoContainer = document.getElementById("video-container");
        const video = document.getElementById("video");

        content.style.display = "block";
        videoContainer.style.display = "none";
        video.pause();

        setTimeout(() => {
          if (!isEditing) {
            content.style.display = "none";
            videoContainer.style.display = "block";
            video.play();
          }
        }, tempoExibicao);
      }

      table.addEventListener(
        "focus",
        function (event) {
          if (event.target.tagName === "TD") {
            isEditing = true;
          }
        },
        true
      );

      table.addEventListener(
        "blur",
        function (event) {
          if (event.target.tagName === "TD") {
            isEditing = false;
          }
        },
        true
      );

      alternar();
      setInterval(alternar, tempoExibicao * 2);

      // Verifica alterações no LocalStorage a cada 5 segundos
      let ultimosDados = localStorage.getItem("tabelaDados");

      function verificarAtualizacoes() {
        const dadosAtuais = localStorage.getItem("tabelaDados");
        if (dadosAtuais !== ultimosDados) {
          ultimosDados = dadosAtuais;
          carregarDados(); // Atualiza a tabela
        }
      }

      setInterval(verificarAtualizacoes, 5000);
    </script>
  </body>
</html>
